<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
            "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
 <head>
  <title>Eet: Eet Library Documentation</title>
  <link href="e.css" rel="stylesheet" type="text/css" />
 </head>

<body>
 <table width="100%" border="0" cellpadding="0" cellspacing="0">
  <tr>
   <td class="t" width="50%" valign="top" align="left">
     <table width="100px" height="100px" border="0" cellpadding="0" cellspacing="0">
     <tr><td class="lnav"><a class="nav" href="http://web.enlightenment.org/p.php?p=index">Home</a></td></tr>
     <tr><td class="lnav"><a class="nav" href="http://web.enlightenment.org/p.php?p=news">News</a></td></tr>
     <tr><td class="lnav"><a class="nav" href="http://web.enlightenment.org/p.php?p=about">About</a></td></tr>
     <tr><td class="rnav"><a class="nav" href="http://web.enlightenment.org/p.php?p=download">Download</a></td></tr>
    </table>
   </td>
   <td class="tl" width="612" height="250" valign="bottom" align="center">
    <img src="_.gif" width="612" height="1" />
    <table border="0" cellpadding="0" cellspacing="4px">
     <tr>
      <td class='nav'><a class='nav' href="index.html">Main&nbsp;Page</a></td>
      <td class="nav"><a class="nav" href="eet_8c.html">API Reference</a></td>
      <td class="nav"><a class="nav" href="globals.html">Globals</a></td>
      <td class="nav"><a class="nav" href="pages.html">Related Pages</a></td>
     </tr>
    </table>
    <hr />
   </td>
   <td class="t" width="50%" valign="top" align="right">
    <table width="100px" height="100px" border="0" cellpadding="0" cellspacing="0">
     <tr><td class="rnav"><a class="nav" href="http://web.enlightenment.org/p.php?p=support">Support</a></td></tr>
     <tr><td class="lnav"><a class="nav" href="http://web.enlightenment.org/p.php?p=contribute">Contribute</a></td></tr>
     <tr><td class="lnav"><a class="nav" href="http://web.enlightenment.org/p.php?p=contact">Contact</a></td></tr>
     <tr><td class="lnav"><a class="nav" href="http://trac.enlightenment.org/e">Tracker</a></td></tr>
    </table>
   </td>
  </tr>
 </table>

 <div class="main">
<!-- Generated by Doxygen 1.5.3 -->
<h1>Eet Library Documentation</h1>
<p>
<div align="center">
<img src="eet.png" alt="eet.png">
</div>
 <dl class="version" compact><dt><b>Version:</b></dt><dd>0.9.99900 </dd></dl>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Carsten Haitzler &lt;raster@rasterman.com&gt; </dd></dl>
<dl class="date" compact><dt><b>Date:</b></dt><dd>2000-2008</dd></dl>
<h2><a class="anchor" name="intro">
What is Eet?</a></h2>
It is a tiny library designed to write an arbitary set of chunks of data to a file and optionally compress each chunk (very much like a zip file) and allow fast random-access reading of the file later on. It does not do zip as a zip itself has more complexity than is needed, and it was much simpler to impliment this once here.<p>
Eet is extremely fast, small and simple. Eet files can be very small and highly compressed, making them very optimal for just sending across the internet without having to archive, compress or decompress and install them. They allow for lightning-fast random-acess reads once created, making them perfect for storing data that is written once (or rarely) and read many times, but the program does not want to have to read it all in at once.<p>
It also can encode and decode data structures in memory, as well as image data for saving to Eet files or sending across the network to other machines, or just writing to arbitary files on the system. All data is encoded in a platform independant way and can be written and read by any architecture.<h2><a class="anchor" name="example">
A simple example on using Eet</a></h2>
Here is a simple example on how to use Eet to save a series of strings to a file and load them again. The advantage of using Eet over just fprintf() and fscanf() is that not only can these entries be strings, they need no special parsing to handle delimiter characters or escaping, they can be binary data, image data, data structures containing integers, strings, other data structures, linked lists and much more, without the programmer having to worry about parsing, and best of all, Eet is very fast.<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="Eet_8h.html">Eet.h</a>&gt;</span>

<span class="keywordtype">int</span>
main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
  Eet_File *ef;
  <span class="keywordtype">int</span>       i;
  <span class="keywordtype">char</span>      buf[32];
  <span class="keywordtype">char</span>     *ret;
  <span class="keywordtype">int</span>       size;
  <span class="keywordtype">char</span>    **entries =
    {
      <span class="stringliteral">"Entry 1"</span>,
      <span class="stringliteral">"Big text string here compared to others"</span>,
      <span class="stringliteral">"Eet is cool"</span>
    };

  <a class="code" href="Eet_8h.html#9903687bfa20fe9a9e59d4c1d213e89a" title="Initialize the EET library.">eet_init</a>();

  <span class="comment">// blindly open an file for output and write strings with their NUL char</span>
  ef = <a class="code" href="Eet_8h.html#5f55956b860aa2c77af9b1a880c4c256" title="Open an eet file on disk, and returns a handle to it.">eet_open</a>(<span class="stringliteral">"test.eet"</span>, EET_FILE_MODE_WRITE);
  <a class="code" href="Eet_8h.html#682d04715f0e11380c460814c4a9bd21" title="Write a specified entry to an eet file handle.">eet_write</a>(ef, <span class="stringliteral">"Entry 1"</span>, entries[0], strlen(entries[0]) + 1, 0);
  <a class="code" href="Eet_8h.html#682d04715f0e11380c460814c4a9bd21" title="Write a specified entry to an eet file handle.">eet_write</a>(ef, <span class="stringliteral">"Entry 2"</span>, entries[1], strlen(entries[1]) + 1, 1);
  <a class="code" href="Eet_8h.html#682d04715f0e11380c460814c4a9bd21" title="Write a specified entry to an eet file handle.">eet_write</a>(ef, <span class="stringliteral">"Entry 3"</span>, entries[2], strlen(entries[2]) + 1, 0);
  <a class="code" href="Eet_8h.html#1675fef1f6012c1e02ae313d13dc3e03" title="Close an eet file handle and flush and writes pending.">eet_close</a>(ef);

  <span class="comment">// open the file again and blindly get the entries we wrote</span>
  ef = <a class="code" href="Eet_8h.html#5f55956b860aa2c77af9b1a880c4c256" title="Open an eet file on disk, and returns a handle to it.">eet_open</a>(<span class="stringliteral">"test.eet"</span>, EET_FILE_MODE_READ);
  ret = <a class="code" href="Eet_8h.html#c13cdf7782d1e513f5b1abcc529962f4" title="Read a specified entry from an eet file and return data.">eet_read</a>(ef, <span class="stringliteral">"Entry 1"</span>, &amp;size);
  printf(<span class="stringliteral">"%s\n"</span>, ret);
  ret = <a class="code" href="Eet_8h.html#c13cdf7782d1e513f5b1abcc529962f4" title="Read a specified entry from an eet file and return data.">eet_read</a>(ef, <span class="stringliteral">"Entry 2"</span>, &amp;size);
  printf(<span class="stringliteral">"%s\n"</span>, ret);
  ret = <a class="code" href="Eet_8h.html#c13cdf7782d1e513f5b1abcc529962f4" title="Read a specified entry from an eet file and return data.">eet_read</a>(ef, <span class="stringliteral">"Entry 3"</span>, &amp;size);
  printf(<span class="stringliteral">"%s\n"</span>, ret);
  <a class="code" href="Eet_8h.html#1675fef1f6012c1e02ae313d13dc3e03" title="Close an eet file handle and flush and writes pending.">eet_close</a>(ef);

  <a class="code" href="Eet_8h.html#cbc7583179399d3b3e7b003e911f866f" title="Shut down the EET library.">eet_shutdown</a>();
}
</pre></div><h2><a class="anchor" name="format">
What does an Eet file look like?</a></h2>
The file format is very simple. There is a directory block at the start of the file listing entries and offsets into the file where they are stored, their sizes, compression flags etc. followed by all the entry data strung one element after the other.<p>
All Eet files start with t a 4 byte magic number. It is written using network byte-order (big endian, or from most significant byte first to least significant byte last) and is 0x1ee7ff00 (or byte by byte 0:1e 1:e7 2:ff 3:00). The next 4 bytes are an integer (in big endian notation) indicating how many entries are stored in the Eet file. 0 indicates it is empty. This is a signed integer and thus values less than 0 are invalid, limiting the number of entries in an Eet file to 0x7fffffff entries at most. The next 4 bytes is the size of the directory table, in bytes, encoded in big-endian format. This is a signed integer and cannot be less than 0.<p>
The directory table for the file follows immediately, with a continuous list of all entries in the Eet file, their offset in the file etc. The order of these entries is not important, but convention would have them be from first to last entry in the file. Each directory entry consiste of 5 integers, one after the other, each stored as a signed, big endian integer. The first is the offset in the file that the data for this entry is stored at (based from the very start of the file, not relative to the end of the directory block). The second integer holds flags for the entry. currently only the least significant bit (bit 0) holds any useful information, and it is set to 1 if the entry is compressed using zlib compression calls, or 0 if it is not compressed. The next integer is the size of the entry in bytes stored in the file. The next integer is the size of the data when decompressed (if it was compressed) in bytes. This may be the same as the previous integer if the entry was not compressed. The final integer is the number of bytes used by the string identifier for the entry, without the NUL byte terminator, which is not stored. The next series of bytes is the string name of the entry, with the number of bytes being the same as specified in the last integer above. This list of entries continues until there are no more entries left to list. To read an entry from an Eet file, simply find the appropriate entry in the directory table, find it's offset and size, and read it into memory. If it is compressed, decompress it using zlib and then use that data.<p>
Here is a data map of an Eet file. All integers are encoded using big-endian notation (most significant byte first) and are signed. There is no alignment of data, so all data types follow immediately on, one after the other. All compressed data is compressed using the zlib compress2() function, and decompressed using the zlib uncompress() function. Please see zlib documentation for more information as to the encoding of compressed data.<p>
<div class="fragment"><pre class="fragment">
HEADER:
[INT] Magic number (0x1ee7ff00)
[INT] Number of entries in the directory table
[INT] The size of the directory table, in bytes

DIRECTORY TABLE ENTRIES (as many as specified in the header):
[INT] Offest from file start at which entry is stored (in bytes)
[INT] Entry flags (1 = compressed, 0 = not compressed)
[INT] Size of data chunk in file (in bytes)
[INT] Size of the data chunk once decompressed (or the same as above, if not)
[INT] The length of the string itendifier, in bytes, without NUL terminator
[STR] Series of bytes for the string identifier, no NUL terminator
... more directory entries

DATA STORED, ONE AFTER ANOTHER:
[DAT] DATA ENTRY 1...
[DAT] DATA ENTRY 2...
[DAT] DATA ENTRY 3...
... more data chunks
</pre></div><p>
The contents of each entry in an Eet file has no defined format as such. It is an opaque chunk of data, that is up to the application to deocde, unless it is an image, ecoded by Eet, or a data structure encoded by Eet. The data itself for these entries can be encoded and decoded by Eet with extra helper functions in Eet. <a class="el" href="Eet_8h.html#986872ec682c29f842b2ef6dad810257" title="Read image data from the named key in the eet file.">eet_data_image_read()</a> and <a class="el" href="Eet_8h.html#b4e8a3419744fac22bca24af533f5051" title="Write image data to the named key in an eet file.">eet_data_image_write()</a> are used to handle reading and writing image data from a known Eet file entry name. <a class="el" href="Eet_8h.html#4d1807cbbc448304f22a8808318a3429" title="Read a data structure from an eet file and decodes it.">eet_data_read()</a> and <a class="el" href="Eet_8h.html#c66d1c49e3490bc5d803982d833ff8aa" title="Write a data structure from memory and store in an eet file.">eet_data_write()</a> are used to decode and encode program data structures from an Eet file, making the loading and saving of program information stored in data structures a simple 1 function call process.<p>
Please see src/lib/eet_data.c for information on the format of these specially encoded data entries in an Eet file (for now).<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Add hash table, fixed and variable array encode/decode support. </dd></dl>
<dl compact><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Document data format for images and data structures.</dd></dl>
  </div>
  <hr />
  <p class="tiny">Copyright &copy; Enlightenment.org</p>
  <p class="tiny">Eet Documentation Generated: Tue Apr 1 07:05:50 2008</p>
 </body>
</html>
